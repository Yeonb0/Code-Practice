name: BOJ to Blog

on:
  push:
    branches:
      - main

jobs:
  boj-to-blog:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code-Practice
        uses: actions/checkout@v4
        with:
          fetch-depth: 2   # ðŸ”‘ HEAD~1 ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install PyGithub

      - name: Get changed files (BOJ only)
        shell: bash
        run: |
          if git rev-parse HEAD~1 >/dev/null 2>&1; then
            git diff --name-only HEAD~1 HEAD > changed.txt
          else
            git diff --name-only HEAD > changed.txt
          fi

      - name: Debug changed.txt
        run: |
          echo "===== changed.txt ====="
          cat changed.txt || true
          echo "======================="

      - name: Run BlogAction
        env:
          BLOG_TOKEN: ${{ secrets.BLOG_TOKEN }}
        run: |
          python BlogAction.py

      - name: Clone blog repo
        env:  
          BLOG_TOKEN: ${{ secrets.BLOG_TOKEN }}
        run: |
          git clone https://x-access-token:${BLOG_TOKEN}@github.com/Yeonb0/Yeonb0.github.io.git blog

      - name: Copy generated posts
        run: |
          mkdir -p blog/_posts/BOJ
          cp _posts/BOJ/*.md blog/_posts/BOJ/ || echo "No posts to copy"

      - name: Commit and push
        run: |
          cd blog
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

          git add _posts/BOJ
          git status

          if git diff --cached --quiet; then
            echo "No changes to commit"
          else
            git commit -m "Add BOJ posts"
            git push
          fi
